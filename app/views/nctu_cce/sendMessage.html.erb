<%= render partial: "layouts/managementHeader", locals: {period: @period} %>
<%= render partial: "user", locals: {period: @period} %>
<h3 class="text-center">群組寄信</h3><br>
<div class="container" >
<%= form_tag('/nctu_cce/sendMessage', multipart: true, class: "form-horizontal") do%>
  <%=hidden_field_tag 'id', @period.id%>
  <div class="form-group">
    <label class="col-sm-offset-1 col-sm-2 control-label">標題</label>
    <div class="col-sm-6">
      <%= text_field_tag 'subject', nil, class: 'form-control', placeholder: '標題'%>	
    </div>
  </div>
  <div class="form-group">  
    <label for="inputEmail3" class="col-sm-offset-1 col-sm-2 control-label">收件人</label>  	
    <div class="col-sm-6"> 
    	<%@period.courses.each do |c| %>
			<%=c.title%><br>   
			<label class="checkbox-inline">
				<%= check_box_tag 'course_'+c.id%>全選			
			</label>   			 	
    		<%c.registered_courses.each do |r_c| %>
    			<%if r_c.progress.stage >= 4%>
					<label class="checkbox-inline">
						<%= check_box_tag 'recipients[]', r_c.progress.user.id, false, class: 'r_c_of_course_'+c.id%><%=r_c.progress.user.name %>
					</label>    			
    			<%end%>	
    		<%end%>
    	<hr>
    	<%end%>
    </div>	
  </div>  
  <div class="form-group">
    <label class="col-sm-offset-1 col-sm-2 control-label">內容</label>
    <div class="col-sm-6">
    	<%= text_area_tag 'content', nil, class: 'form-control', rows: 3, cols: 10, placeholder: "內容"%>
    </div>
  </div>
  <div class="form-group">
    <label class="col-sm-offset-1 col-sm-2 control-label">附件</label>
	<div class="col-sm-6">
 		<input name="attachment[]" id="input-att" type="file" class="file" data-preview-file-type="text" multiple>
	</div>   
  </div> 
  <div class="form-group">
    <div class="col-sm-offset-3 col-sm-6">
      <%=submit_tag "寄出", class: "btn btn-primary", "data-loading-text"=>"寄送中..." %>	
    </div>
  </div>
<%end%>
</div>
<script>
$("#input-att").fileinput({showUpload:false, browseClass: "btn btn-default", browseLabel: " 選取檔案（可多選）", 'previewFileType':'any', 'showCaption': false});
</script>